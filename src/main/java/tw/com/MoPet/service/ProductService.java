package tw.com.MoPet.service;

import java.util.Base64;
import java.util.Calendar;
import java.util.Date;
import java.util.List;
import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;
import org.springframework.web.multipart.MultipartFile;

import tw.com.MoPet.model.Product;
import tw.com.MoPet.model.ProductRepository;

@Service
@Transactional
public class ProductService {
	
	@Autowired
	private ProductRepository pDao;
	
	public void insertProduct(Product product) {
		pDao.save(product);
	}
	
	public List<Product> findByCategory(Integer integer){
		return pDao.findByCategoryId(integer);
	}
	
	public Product getById(Integer id) {
		Optional<Product> option=pDao.findById(id);
		if(option.isPresent()) {
		return option.get();
			}
		return null;
	}
	
	public List<Product> findAll() {
		return pDao.findAll();
	}
	
	public void deleteProduct(Integer id) {
		pDao.deleteById(id);
	}
	
	public Page<Product> findByPage(Integer productPageNumber){
		PageRequest pgb=PageRequest.of(productPageNumber-1,5,Sort.Direction.DESC,"pAdded");
		Page<Product> page=pDao.findAll(pgb);
		return page;
	}
	
	public String getBase64(MultipartFile file) throws Exception {
		String header =file.getOriginalFilename();
		int lastof=header.lastIndexOf(".");
		String typeName=header.substring(lastof+1, header.length()-1);
		System.out.println(file.getOriginalFilename());
		
		byte[] picStr=file.getBytes();
		String basePic=Base64.getEncoder().encodeToString(picStr);
		String base64Str="data:image/"+typeName+";base64,"+basePic;
		
		return base64Str;
	}
	
	public Date getTimeNow() {
		return Calendar.getInstance().getTime();
	}
	
	public String getDefaultimg() {
		return "data:image/jp;base64,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";
	}

}
